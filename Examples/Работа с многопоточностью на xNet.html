<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0029)http://blog.epicsoft.ru/?p=26 -->
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="ru-RU"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>   Работа с многопоточностью на xNet | Блог | Epic Soft</title>

<meta name="description" content="Блог о программировании">
<meta name="generator" content="WordPress 3.4.1"> <!-- leave this for stats please -->
<link href="./Работа с многопоточностью на xNet_files/style.css" rel="stylesheet" type="text/css" media="screen">
<link rel="alternate" type="application/rss+xml" title="Блог | Epic Soft RSS Feed" href="http://blog.epicsoft.ru/?feed=rss2">
<link rel="shortcut icon" href="http://blog.epicsoft.ru/wp-content/themes/epicsoft/favicon.ico">
<link rel="pingback" href="http://blog.epicsoft.ru/xmlrpc.php">
<script type="text/javascript" src="./Работа с многопоточностью на xNet_files/jquery-1.7.1.min.js"></script>
<link rel="alternate" type="application/rss+xml" title="Блог | Epic Soft » Лента комментариев к «Работа с многопоточностью на xNet»" href="http://blog.epicsoft.ru/?feed=rss2&p=26">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://blog.epicsoft.ru/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://blog.epicsoft.ru/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="Работа с Web на xNet" href="http://blog.epicsoft.ru/?p=8">
<link rel="next" title="Парсинг данных" href="http://blog.epicsoft.ru/?p=34">
<meta name="generator" content="WordPress 3.4.1">
<link rel="canonical" href="./Работа с многопоточностью на xNet_files/Работа с многопоточностью на xNet.html">
	<link type="text/css" rel="stylesheet" href="./Работа с многопоточностью на xNet_files/shCore.css">
	<link type="text/css" rel="stylesheet" href="./Работа с многопоточностью на xNet_files/shThemeDefault.css">
<script type="text/javascript" src="chrome-extension://nhgcieglcpdegkhamigiokdphfhhnlhh/js/injected.js" charset="utf-8"></script></head>

<body>
    <!--main-->
    <div id="main">
        <!--header-wrap-->
        <div id="header-wrap">
            <!--logo-->
            <div id="logo">
                <p>
                    <a href="http://blog.epicsoft.ru/"><span class="first-letter">E</span>pic<span class="first-letter">S</span>oft</a></p>
            </div>
            <!--/logo-->
        </div>
        <!--/header-wrap-->
<div id="content">

<h2 id="post-26">Работа с многопоточностью на xNet</h2>
<div class="link-comment-count"><a href="http://blog.epicsoft.ru/?p=26#comments">К комментариям</a></div>

<div class="main">
	<p>Данная статья посвящена многопоточной части библиотеки <em>xNet</em>. В статье будет рассмотрено: запуск действия в нескольких потоках, многопоточный обход коллекции, асинхронные события и другое. Статья ориентирована на программистов, знающих основы многопоточного программирования. В конце статьи указаны ссылки на материалы по теме.</p>
<p><strong>Класс MultiThreading</strong></p>
<p>Данный класс представляет из себя этакую смесь класса <a href="http://msdn.microsoft.com/ru-ru/library/system.componentmodel.backgroundworker.aspx" title="BackgroundWorker" target="_blank">BackgroundWorker</a> с классом <a href="http://msdn.microsoft.com/ru-ru/library/system.threading.tasks.parallel.aspx" title="Parallel" target="_blank">Parallel</a>. Он не использует <a href="http://msdn.microsoft.com/ru-ru/library/system.threading.threadpool.aspx" title="ThreadPool" target="_blank">ThreadPool</a>, а все потоки выполняются в фоновом режиме.</p>
<p>В нём есть три основных метода:</p>
<ul>
<li><em>Run</em> — выполняет операцию в отдельных потоках.</li>
<li><em>RunFor</em> — выполняет цикл <em>for</em> в отдельных потоках.</li>
<li><em>RunForEach</em> — выполняет цикл <em>foreach</em> в отдельных потоках.</li>
</ul>
<p>Итак, простейший пример:</p>
<div class="syntaxhighlighter " id="highlighter_109739" style=""><div class="bar"><div class="toolbar"><a href="http://blog.epicsoft.ru/?p=26#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http://blog.epicsoft.ru/?p=26#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http://blog.epicsoft.ru/?p=26#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">01.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">static</code> <code class="keyword">void</code> <code class="plain">Main(</code><code class="keyword">string</code><code class="plain">[] args)</code></span></span></div><div class="line alt2"><code class="number">02.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">03.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">var mt = </code><code class="keyword">new</code> <code class="plain">MultiThreading&lt;</code><code class="keyword">int</code><code class="plain">&gt;(10);</code></span></span></div><div class="line alt2"><code class="number">04.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">05.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">mt.Run(MyAction);</code></span></span></div><div class="line alt2"><code class="number">06.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">07.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">Thread.Sleep(1000);</code></span></span></div><div class="line alt2"><code class="number">08.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">Console.ReadKey();</code></span></span></div><div class="line alt1"><code class="number">09.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">10.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">11.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">static</code> <code class="keyword">void</code> <code class="plain">MyAction(MultiThreading&lt;</code><code class="keyword">int</code><code class="plain">&gt; mt)</code></span></span></div><div class="line alt2"><code class="number">12.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">13.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">Console.WriteLine(</code><code class="string">"Hello Thread!"</code><code class="plain">);</code></span></span></div><div class="line alt2"><code class="number">14.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div></div></div>
<p>Здесь мы выполняем метод <em>MyAction</em> в десяти потоках. Текст «Hello Thread!» будет выведен десять раз в консоль.</p>
<p><span id="more-26"></span></p>
<p>А теперь пример посложней. В нём уже используются специальные события:</p>
<div class="syntaxhighlighter " id="highlighter_56567" style=""><div class="bar"><div class="toolbar"><a href="http://blog.epicsoft.ru/?p=26#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http://blog.epicsoft.ru/?p=26#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http://blog.epicsoft.ru/?p=26#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">01.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">static</code> <code class="keyword">void</code> <code class="plain">Main(</code><code class="keyword">string</code><code class="plain">[] args)</code></span></span></div><div class="line alt2"><code class="number">02.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">03.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">var mt = </code><code class="keyword">new</code> <code class="plain">MultiThreading&lt;</code><code class="keyword">int</code><code class="plain">&gt;(3);</code></span></span></div><div class="line alt2"><code class="number">04.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">05.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">mt.BeginningWork += mt_BeginningWork;</code></span></span></div><div class="line alt2"><code class="number">06.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">mt.CancelingWork += mt_CancelingWork;</code></span></span></div><div class="line alt1"><code class="number">07.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">mt.WorkCompleted += mt_WorkCompleted;</code></span></span></div><div class="line alt2"><code class="number">08.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">mt.ProgressChanged += mt_ProgressChanged;</code></span></span></div><div class="line alt1"><code class="number">09.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">10.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">var numbers = </code><code class="keyword">new</code> <code class="keyword">int</code><code class="plain">[] { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 };</code></span></span></div><div class="line alt1"><code class="number">11.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">12.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">mt.RunForEach&lt;</code><code class="keyword">int</code><code class="plain">&gt;(numbers, MyAction);</code></span></span></div><div class="line alt1"><code class="number">13.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">14.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">Thread.Sleep(5000);</code></span></span></div><div class="line alt1"><code class="number">15.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">16.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">mt.Cancel();</code></span></span></div><div class="line alt1"><code class="number">17.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">18.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">Console.ReadKey();</code></span></span></div><div class="line alt1"><code class="number">19.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">20.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">21.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">static</code> <code class="keyword">void</code> <code class="plain">MyAction(MultiThreading&lt;</code><code class="keyword">int</code><code class="plain">&gt; mt, </code><code class="keyword">int</code> <code class="plain">number)</code></span></span></div><div class="line alt2"><code class="number">22.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">23.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="comments">// Работаем до тех пор, пока не запрошена отмена.</code></span></span></div><div class="line alt2"><code class="number">24.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">while</code> <code class="plain">(!mt.Canceling)</code></span></span></div><div class="line alt1"><code class="number">25.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">26.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="comments">// Сообщаем о результате.</code></span></span></div><div class="line alt1"><code class="number">27.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">mt.ReportProgress(++number);</code></span></span></div><div class="line alt2"><code class="number">28.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">Thread.Sleep(1000);</code></span></span></div><div class="line alt1"><code class="number">29.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">30.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">31.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">32.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">static</code> <code class="keyword">void</code> <code class="plain">mt_BeginningWork(</code><code class="keyword">object</code> <code class="plain">sender, EventArgs e)</code></span></span></div><div class="line alt1"><code class="number">33.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">34.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">Console.WriteLine(</code><code class="string">"***Начало работы***"</code><code class="plain">);</code></span></span></div><div class="line alt1"><code class="number">35.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">36.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">37.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">static</code> <code class="keyword">void</code> <code class="plain">mt_CancelingWork(</code><code class="keyword">object</code> <code class="plain">sender, EventArgs e)</code></span></span></div><div class="line alt2"><code class="number">38.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">39.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">Console.WriteLine(</code><code class="string">"***Отмена***"</code><code class="plain">);</code></span></span></div><div class="line alt2"><code class="number">40.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">41.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">42.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">static</code> <code class="keyword">void</code> <code class="plain">mt_WorkCompleted(</code><code class="keyword">object</code> <code class="plain">sender, MultiThreadingCompletedEventArgs e)</code></span></span></div><div class="line alt1"><code class="number">43.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">44.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">if</code> <code class="plain">(e.HasErrors)</code></span></span></div><div class="line alt1"><code class="number">45.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">46.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">Console.WriteLine(</code><code class="string">"Во время работы произошла ошибк(а|и)..."</code><code class="plain">);</code></span></span></div><div class="line alt1"><code class="number">47.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="comments">//...</code></span></span></div><div class="line alt2"><code class="number">48.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">49.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">50.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">Console.WriteLine(</code><code class="string">"***Работа закончена***"</code><code class="plain">);</code></span></span></div><div class="line alt1"><code class="number">51.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">52.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">53.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">static</code> <code class="keyword">void</code> <code class="plain">mt_ProgressChanged(</code><code class="keyword">object</code> <code class="plain">sender, MultiThreadingProgressEventArgs&lt;</code><code class="keyword">int</code><code class="plain">&gt; e)</code></span></span></div><div class="line alt2"><code class="number">54.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">55.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">Console.WriteLine(</code><code class="string">"Результат: {0}"</code><code class="plain">, e.Result);</code></span></span></div><div class="line alt2"><code class="number">56.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div></div></div>
<p>Здесь мы проходим по массиву чисел в трёх потоках. Перед началом выполнения операции, для каждого потока устанавливаются свои диапазоны. Так, первый поток пройдёт с 1 по 4 элемент, второй с 5 по 7, а третий с 8 по 10. Но это только в том случае, если коллекция реализует интерфейс <a href="http://msdn.microsoft.com/ru-ru/library/system.collections.ilist.aspx" title="IList" target="_blank">IList</a>, иначе потоки просто запрашивают новое значение в перечислителе до тех пор, пока не будет достигнут конец коллекции.</p>
<p>Обратите внимание — для сообщения о результате, я использовал метод <em>MultiThreading.ReportProgress</em>, который асинхронно вызывает событие <em>MultiThreading.ProgressChanged</em>. В данном случае, возможности асинхронных событий не требуются, поэтому следует использовать метод <em>MultiThreading.ReportProgressSync</em>, который вызовет событие обычным образом, что повысит производительность.</p>
<p>Если во время выполнения асинхронной операции произойдёт исключение, то будет запрошена отмена. Информацию об исключении можно будет получить с помощью события <em>MultiThreading.WorkCompleted</em>.</p>
<p>Выполнение асинхронной операции можно бесконечно повторять, если установить свойство <em>MultiThreading.UseInfiniteRepeat</em> равным <em>true</em>.</p>
<div class="syntaxhighlighter " id="highlighter_442383" style=""><div class="bar"><div class="toolbar"><a href="http://blog.epicsoft.ru/?p=26#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http://blog.epicsoft.ru/?p=26#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http://blog.epicsoft.ru/?p=26#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">01.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">static</code> <code class="keyword">void</code> <code class="plain">Main(</code><code class="keyword">string</code><code class="plain">[] args)</code></span></span></div><div class="line alt2"><code class="number">02.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">03.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">var mt = </code><code class="keyword">new</code> <code class="plain">MultiThreading&lt;</code><code class="keyword">int</code><code class="plain">&gt;(3)</code></span></span></div><div class="line alt2"><code class="number">04.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">05.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">UseInfiniteRepeat = </code><code class="keyword">true</code></span></span></div><div class="line alt2"><code class="number">06.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">};</code></span></span></div><div class="line alt1"><code class="number">07.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">08.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">mt.RepeatCompleted += mt_RepeatCompleted;</code></span></span></div><div class="line alt1"><code class="number">09.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">10.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">mt.Run(MyAction);</code></span></span></div><div class="line alt1"><code class="number">11.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">12.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">Thread.Sleep(1000);</code></span></span></div><div class="line alt1"><code class="number">13.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">Console.ReadKey();</code></span></span></div><div class="line alt2"><code class="number">14.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">15.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">16.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">static</code> <code class="keyword">void</code> <code class="plain">MyAction(MultiThreading&lt;</code><code class="keyword">int</code><code class="plain">&gt; mt)</code></span></span></div><div class="line alt1"><code class="number">17.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">18.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">Console.WriteLine(</code><code class="string">"Hello Thread!"</code><code class="plain">);</code></span></span></div><div class="line alt1"><code class="number">19.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">Thread.Sleep(1000);</code></span></span></div><div class="line alt2"><code class="number">20.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">21.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">22.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">static</code> <code class="keyword">void</code> <code class="plain">mt_RepeatCompleted(</code><code class="keyword">object</code> <code class="plain">sender, MultiThreadingRepeatEventArgs e)</code></span></span></div><div class="line alt1"><code class="number">23.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">24.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">Console.WriteLine(</code><code class="string">"Выполненно повторов: {0}"</code><code class="plain">, e.RepsCount);</code></span></span></div><div class="line alt1"><code class="number">25.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div></div></div>
<p><strong>Класс AsyncEvent</strong></p>
<p>Данный класс представляет простую оболочку для асинхронного вызова события с помощью класса <a href="http://msdn.microsoft.com/ru-ru/library/system.componentmodel.asyncoperation.aspx" title="AsyncOperation" target="_blank">AsyncOperation</a>. Собственно, зачем нужно такое событие? Дело в том, что оно будет вызываться в том потоке, где будет создан экземпляр объекта <em>AsyncOperation</em>, независимо от того, в каком потоке изначально оно будет вызвано. Это может пригодиться в оконном приложение, где к элементам управления можно обращаться только из главного потока.</p>
<p>Более подробно об этом вы можете прочитать на сайте <a href="http://msdn.microsoft.com/ru-ru/library/e7a34yad.aspx" title="Реализация асинхронной модели, основанной на событиях" target="_blank">MSDN</a>.</p>
<p>Итак, пример использования:</p>
<div class="syntaxhighlighter " id="highlighter_939000" style=""><div class="bar"><div class="toolbar"><a href="http://blog.epicsoft.ru/?p=26#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http://blog.epicsoft.ru/?p=26#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http://blog.epicsoft.ru/?p=26#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">01.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">public</code> <code class="plain">partial </code><code class="keyword">class</code> <code class="plain">Form1 : Form</code></span></span></div><div class="line alt2"><code class="number">02.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">03.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">AsyncOperation _asyncOperation;</code></span></span></div><div class="line alt2"><code class="number">04.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">AsyncEvent&lt;EventArgs&gt; _testAsyncEvent;</code></span></span></div><div class="line alt1"><code class="number">05.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">06.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">event</code> <code class="plain">EventHandler&lt;EventArgs&gt; Test</code></span></span></div><div class="line alt1"><code class="number">07.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">08.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">add</code></span></span></div><div class="line alt1"><code class="number">09.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">10.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 108px !important;"><code class="plain">_testAsyncEvent.EventHandler += value;</code></span></span></div><div class="line alt1"><code class="number">11.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">12.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">remove</code></span></span></div><div class="line alt1"><code class="number">13.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">14.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 108px !important;"><code class="plain">_testAsyncEvent.EventHandler -= value;</code></span></span></div><div class="line alt1"><code class="number">15.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">16.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">17.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">18.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">public</code> <code class="plain">Form1()</code></span></span></div><div class="line alt1"><code class="number">19.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">20.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">InitializeComponent();</code></span></span></div><div class="line alt1"><code class="number">21.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">22.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="comments">// Создаём объект для асинхронных операций.</code></span></span></div><div class="line alt1"><code class="number">23.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">_asyncOperation =</code></span></span></div><div class="line alt2"><code class="number">24.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 108px !important;"><code class="plain">AsyncOperationManager.CreateOperation(</code><code class="keyword">new</code> <code class="keyword">object</code><code class="plain">());</code></span></span></div><div class="line alt1"><code class="number">25.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">26.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="comments">// Создаём наше событие.</code></span></span></div><div class="line alt1"><code class="number">27.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">_testAsyncEvent = </code><code class="keyword">new</code> <code class="plain">AsyncEvent&lt;EventArgs&gt;(OnTest);</code></span></span></div><div class="line alt2"><code class="number">28.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">29.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">Test += Form1_Test;</code></span></span></div><div class="line alt2"><code class="number">30.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">31.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">32.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">void</code> <code class="plain">OnTest(EventArgs e)</code></span></span></div><div class="line alt1"><code class="number">33.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">34.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">_testAsyncEvent.On(</code><code class="keyword">this</code><code class="plain">, e);</code></span></span></div><div class="line alt1"><code class="number">35.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">36.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">37.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">void</code> <code class="plain">Form1_Test(</code><code class="keyword">object</code> <code class="plain">sender, EventArgs e)</code></span></span></div><div class="line alt2"><code class="number">38.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">39.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="comments">// Изменяем заголовок окна.</code></span></span></div><div class="line alt2"><code class="number">40.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="comments">// Данная операция разрешена только в главном потоке.</code></span></span></div><div class="line alt1"><code class="number">41.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">Text = </code><code class="string">"Test Done"</code><code class="plain">;</code></span></span></div><div class="line alt2"><code class="number">42.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">43.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">44.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">void</code> <code class="plain">button1_Click(</code><code class="keyword">object</code> <code class="plain">sender, EventArgs e)</code></span></span></div><div class="line alt1"><code class="number">45.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">46.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="comments">// Асинхронно вызываем событие в отдельном фоновом потоке.</code></span></span></div><div class="line alt1"><code class="number">47.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">Task.Factory.StartNew(() =&gt;</code></span></span></div><div class="line alt2"><code class="number">48.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 108px !important;"><code class="plain">_testAsyncEvent.Post(_asyncOperation, </code><code class="keyword">this</code><code class="plain">, EventArgs.Empty));</code></span></span></div><div class="line alt1"><code class="number">49.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">50.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div></div></div>
<p><strong>Создаём свой класс на основе MultiThreading</strong></p>
<p>Класс <em>MultiThreading</em> сделан таким образом, чтобы от него можно было наследовать. Можно добавить свои асинхронные события, переопределить некоторые методы и другое.</p>
<p>Код класса:</p>
<div class="syntaxhighlighter " id="highlighter_868826" style=""><div class="bar"><div class="toolbar"><a href="http://blog.epicsoft.ru/?p=26#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http://blog.epicsoft.ru/?p=26#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http://blog.epicsoft.ru/?p=26#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">01.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">class</code> <code class="plain">Executer : MultiThreading&lt;</code><code class="keyword">int</code><code class="plain">&gt;</code></span></span></div><div class="line alt2"><code class="number">02.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">03.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">private</code> <code class="keyword">int</code> <code class="plain">_doneCount;</code></span></span></div><div class="line alt2"><code class="number">04.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">05.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">private</code> <code class="plain">AsyncEvent&lt;EventArgs&gt; _doneAsyncEvent;</code></span></span></div><div class="line alt2"><code class="number">06.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">private</code> <code class="plain">AsyncEvent&lt;EventArgs&gt; _notDoneAsyncEvent;</code></span></span></div><div class="line alt1"><code class="number">07.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">08.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">public</code> <code class="keyword">int</code> <code class="plain">DoneCount</code></span></span></div><div class="line alt1"><code class="number">09.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">10.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="keyword">get</code></span></span></div><div class="line alt1"><code class="number">11.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">12.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 108px !important;"><code class="keyword">return</code> <code class="plain">_doneCount;</code></span></span></div><div class="line alt1"><code class="number">13.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">14.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">15.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">16.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">public</code> <code class="keyword">event</code> <code class="plain">EventHandler&lt;EventArgs&gt; Done</code></span></span></div><div class="line alt1"><code class="number">17.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">18.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">add</code></span></span></div><div class="line alt1"><code class="number">19.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">20.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 108px !important;"><code class="plain">_doneAsyncEvent.EventHandler += value;</code></span></span></div><div class="line alt1"><code class="number">21.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">22.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">remove</code></span></span></div><div class="line alt1"><code class="number">23.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">24.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 108px !important;"><code class="plain">_doneAsyncEvent.EventHandler -= value;</code></span></span></div><div class="line alt1"><code class="number">25.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">26.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">27.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">28.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">public</code> <code class="keyword">event</code> <code class="plain">EventHandler&lt;EventArgs&gt; NotDone</code></span></span></div><div class="line alt1"><code class="number">29.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">30.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">add</code></span></span></div><div class="line alt1"><code class="number">31.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">32.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 108px !important;"><code class="plain">_notDoneAsyncEvent.EventHandler += value;</code></span></span></div><div class="line alt1"><code class="number">33.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">34.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">remove</code></span></span></div><div class="line alt1"><code class="number">35.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">36.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 108px !important;"><code class="plain">_notDoneAsyncEvent.EventHandler -= value;</code></span></span></div><div class="line alt1"><code class="number">37.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">38.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">39.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">40.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">public</code> <code class="plain">Executer(</code><code class="keyword">int</code> <code class="plain">threadsCount = 1)</code></span></span></div><div class="line alt1"><code class="number">41.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">: </code><code class="keyword">base</code><code class="plain">(threadsCount)</code></span></span></div><div class="line alt2"><code class="number">42.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">43.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">_doneAsyncEvent = </code><code class="keyword">new</code> <code class="plain">AsyncEvent&lt;EventArgs&gt;(OnDone);</code></span></span></div><div class="line alt2"><code class="number">44.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">_notDoneAsyncEvent = </code><code class="keyword">new</code> <code class="plain">AsyncEvent&lt;EventArgs&gt;(OnNotDone);</code></span></span></div><div class="line alt1"><code class="number">45.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">46.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">47.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">public</code> <code class="keyword">void</code> <code class="plain">ReportDone()</code></span></span></div><div class="line alt2"><code class="number">48.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">49.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">Interlocked.Increment(</code><code class="keyword">ref</code> <code class="plain">_doneCount);</code></span></span></div><div class="line alt2"><code class="number">50.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">_doneAsyncEvent.Post(AsyncOperation, </code><code class="keyword">this</code><code class="plain">, EventArgs.Empty);</code></span></span></div><div class="line alt1"><code class="number">51.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">52.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">53.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">public</code> <code class="keyword">void</code> <code class="plain">ReportNotDone()</code></span></span></div><div class="line alt2"><code class="number">54.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">55.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">_notDoneAsyncEvent.Post(AsyncOperation, </code><code class="keyword">this</code><code class="plain">, EventArgs.Empty);</code></span></span></div><div class="line alt2"><code class="number">56.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">57.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">58.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">protected</code> <code class="keyword">override</code> <code class="keyword">void</code> <code class="plain">OnBeginningWork(EventArgs e)</code></span></span></div><div class="line alt1"><code class="number">59.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">60.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">_doneCount = 0;</code></span></span></div><div class="line alt1"><code class="number">61.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="keyword">base</code><code class="plain">.OnBeginningWork(e);</code></span></span></div><div class="line alt2"><code class="number">62.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">63.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">64.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">private</code> <code class="keyword">void</code> <code class="plain">OnDone(EventArgs e)</code></span></span></div><div class="line alt1"><code class="number">65.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">66.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">_doneAsyncEvent.On(</code><code class="keyword">this</code><code class="plain">, e);</code></span></span></div><div class="line alt1"><code class="number">67.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">68.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">69.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">private</code> <code class="keyword">void</code> <code class="plain">OnNotDone(EventArgs e)</code></span></span></div><div class="line alt2"><code class="number">70.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">71.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">_notDoneAsyncEvent.On(</code><code class="keyword">this</code><code class="plain">, e);</code></span></span></div><div class="line alt2"><code class="number">72.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">73.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div></div></div>
<p>Код его использования:</p>
<div class="syntaxhighlighter " id="highlighter_44945" style=""><div class="bar"><div class="toolbar"><a href="http://blog.epicsoft.ru/?p=26#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http://blog.epicsoft.ru/?p=26#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http://blog.epicsoft.ru/?p=26#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">01.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">static</code> <code class="keyword">void</code> <code class="plain">Main(</code><code class="keyword">string</code><code class="plain">[] args)</code></span></span></div><div class="line alt2"><code class="number">02.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">03.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">var executer = </code><code class="keyword">new</code> <code class="plain">Executer(5);</code></span></span></div><div class="line alt2"><code class="number">04.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">05.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">executer.Done += executer_Done;</code></span></span></div><div class="line alt2"><code class="number">06.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">executer.NotDone += executer_NotDone;</code></span></span></div><div class="line alt1"><code class="number">07.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">executer.WorkCompleted += executer_WorkCompleted;</code></span></span></div><div class="line alt2"><code class="number">08.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">09.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">executer.Run(MyAction);</code></span></span></div><div class="line alt2"><code class="number">10.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">11.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">Thread.Sleep(1000);</code></span></span></div><div class="line alt2"><code class="number">12.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">Console.ReadKey();</code></span></span></div><div class="line alt1"><code class="number">13.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">14.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">15.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">static</code> <code class="keyword">void</code> <code class="plain">MyAction(MultiThreading&lt;</code><code class="keyword">int</code><code class="plain">&gt; mt)</code></span></span></div><div class="line alt2"><code class="number">16.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">17.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">var executer = mt </code><code class="keyword">as</code> <code class="plain">Executer;</code></span></span></div><div class="line alt2"><code class="number">18.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">19.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">if</code> <code class="plain">(Rand.Next(2) == 1)</code></span></span></div><div class="line alt2"><code class="number">20.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">21.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">executer.ReportDone();</code></span></span></div><div class="line alt2"><code class="number">22.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">23.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="keyword">else</code></span></span></div><div class="line alt2"><code class="number">24.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">25.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 72px !important;"><code class="plain">executer.ReportNotDone();</code></span></span></div><div class="line alt2"><code class="number">26.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">27.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">28.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">29.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">static</code> <code class="keyword">void</code> <code class="plain">executer_Done(</code><code class="keyword">object</code> <code class="plain">sender, EventArgs e)</code></span></span></div><div class="line alt2"><code class="number">30.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">31.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">Console.WriteLine(</code><code class="string">"Задание выполнено."</code><code class="plain">);</code></span></span></div><div class="line alt2"><code class="number">32.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">33.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">34.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">static</code> <code class="keyword">void</code> <code class="plain">executer_NotDone(</code><code class="keyword">object</code> <code class="plain">sender, EventArgs e)</code></span></span></div><div class="line alt1"><code class="number">35.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">36.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">Console.WriteLine(</code><code class="string">"Не удалось выполнить задание."</code><code class="plain">);</code></span></span></div><div class="line alt1"><code class="number">37.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">38.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">39.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">static</code> <code class="keyword">void</code> <code class="plain">executer_WorkCompleted(</code><code class="keyword">object</code> <code class="plain">sender, MultiThreadingCompletedEventArgs e)</code></span></span></div><div class="line alt2"><code class="number">40.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">41.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">var executer = sender </code><code class="keyword">as</code> <code class="plain">Executer;</code></span></span></div><div class="line alt2"><code class="number">42.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">43.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 36px !important;"><code class="plain">Console.WriteLine(</code><code class="string">"Заданий выполнено: {0}"</code><code class="plain">, executer.DoneCount);</code></span></span></div><div class="line alt2"><code class="number">44.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div></div></div>
<p><strong>Ссылки на материалы по теме</strong></p>
<ul>
<li><a href="http://msdn.microsoft.com/ru-ru/library/ms173178.aspx" title="Работа с потоками" target="_blank">Работа с потоками</a></li>
<li><a href="http://msdn.microsoft.com/ru-ru/library/e7a34yad.aspx" title="Реализация асинхронной модели, основанной на событиях" target="_blank">Реализация асинхронной модели, основанной на событиях</a></li>
</ul>
<p>Читайте справку для получения детальной информации.</p>
</div>

<div class="record-info">
<div class="autor-date">
    <p>Автор: X-rus <span class="edit"></span></p>
    <p>28 Янв 2012 в 11:48</p>
</div>	
<div class="tags">
    <p>Рубрика: <a href="http://blog.epicsoft.ru/?cat=9" title="Просмотреть все записи в рубрике «C#»" rel="category">C#</a>,<a href="http://blog.epicsoft.ru/?cat=5" title="Просмотреть все записи в рубрике «xNet»" rel="category">xNet</a></p>
    <p>Метки: <a href="http://blog.epicsoft.ru/?tag=net" rel="tag">.NET</a>, <a href="http://blog.epicsoft.ru/?tag=c" rel="tag">C#</a>, <a href="http://blog.epicsoft.ru/?tag=xnet" rel="tag">xNet</a>, <a href="http://blog.epicsoft.ru/?tag=%d0%bc%d0%bd%d0%be%d0%b3%d0%be%d0%bf%d0%be%d1%82%d0%be%d1%87%d0%bd%d0%be%d1%81%d1%82%d1%8c" rel="tag">Многопоточность</a></p></div>
</div>

<script type="text/javascript">
	function ins_quote(nick, comment_id)
	{
		var text = '';
		var area = $('textarea')[0];
		
		if (area.value.length > 0)
			text += '\n';
			
		text += '[url=#' + comment_id + ']@' + nick + '[/url]\n';
		
		if (document.getSelection &&
			document.getSelection().toString().length > 0)
		{	
			text += '[quote]' + document.getSelection().toString() + '[/quote]';
		}
		
		area.value += text;
		area.focus();
	}
	
	function ins_tag(tag_start, tag_end)
	{
		var area = $('textarea')[0];
		
		area.focus();
		
		if (document.getSelection)
		{
			var startIndex = area.selectionStart;
			var selection = area.value.substring(area.selectionStart, area.selectionEnd);
			
			area.value=area.value.substring(0, area.selectionStart) + tag_start + selection + tag_end+
				area.value.substring(area.selectionEnd, area.value.length);

			area.selectionStart = startIndex + tag_start.length;
			area.selectionEnd = area.selectionStart + selection.length;
		}

		area.focus();
	}
	
	function ins_tag_link()
	{
		var area = $('textarea')[0];
		
		area.focus();
		
		if (document.getSelection)
		{
			var startIndex = area.selectionStart;
			var selection = area.value.substring(area.selectionStart, area.selectionEnd);
			
			if (area.selectionStart != area.selectionEnd)
			{
				area.value=area.value.substring(0, area.selectionStart) + '[url='+ selection+ ']'+
					selection + '[/url]' + area.value.substring(area.selectionEnd, area.value.length);
					
				area.selectionStart = startIndex + 6 + selection.length;
			}
			else
			{
				area.value=area.value.substring(0, area.selectionStart) + '[url]'+
					selection + '[/url]' + area.value.substring(area.selectionEnd, area.value.length);
					
				area.selectionStart = startIndex + 5 + selection.length;
			}
				
			area.selectionEnd = area.selectionStart + selection.length;;
		}

		area.focus();
	}
	
	function ins_tag_list(tag_start, tag_end)
	{
		var area = $('textarea')[0];
		
		area.focus();
		
		if (document.getSelection)
		{
			var list = tag_start + '\n[li]значение 1[/li]\n[li]значение 2[/li]\n[li]значение 3[/li]\n' + tag_end;
			area.selectionEnd = area.selectionStart;
			
			area.value=area.value.substring(0, area.selectionStart) + list +
				area.value.substring(area.selectionEnd, area.value.length);
		}

		area.focus();
	}
</script>

<!-- You can start editing here. -->


 
<!-- If comments are open, but there are no comments. -->




<h3 class="your-comment">Ваш комментарий</h3>


<form action="http://blog.epicsoft.ru/wp-comments-post.php" method="post" name="commentform" id="commentform">
<div class="postinput">
<p><input type="text" name="author" id="author" value="" size="22" tabindex="1">
<label for="author"><small>Имя *</small></label></p>

<p><input type="text" name="email" id="email" value="" size="22" tabindex="2">
<label for="email"><small>Почта (не публикуется) *</small></label></p>

<p><input type="text" name="url" id="url" value="" size="22" tabindex="3">
<label for="url"><small>Сайт</small></label></p>


<div title="Жирный текст" class="bb bb-bold" onclick="ins_tag(&#39;[b]&#39;,&#39;[/b]&#39;)">B</div><div title="Наклонный текст" class="bb bb-italic" onclick="ins_tag(&#39;[i]&#39;,&#39;[/i]&#39;)">i</div><div title="Зачёркнутый текст" class="bb bb-striked" onclick="ins_tag(&#39;[s]&#39;,&#39;[/s]&#39;)">S</div><div title="Ссылка. Можно выделить ссылку и написать свой текст." class="bb bb-link" onclick="ins_tag_link()">link</div><div title="Внешнее изображение. Можно выделить URL на изображение." class="bb" onclick="ins_tag(&#39;[img]&#39;,&#39;[/img]&#39;)">img</div><div title="Код. По умолчанию ЯП - C#. Можно установить другой." class="bb" onclick="ins_tag(&#39;[code=\&#39;c#\&#39;]&#39;,&#39;[/code]&#39;)">code</div><div title="Маркированный список" class="bb" onclick="ins_tag_list(&#39;[ul]&#39;,&#39;[/ul]&#39;)">ul</div><div title="Нумерованный  список" class="bb" onclick="ins_tag_list(&#39;[ol]&#39;,&#39;[/ol]&#39;)">ol</div>
<p><textarea style="width: 714px" name="b5173-comment" id="comment" cols="100%" rows="10" tabindex="4"></textarea><textarea name="comment" style="display:none" rows="1" cols="1"></textarea></p>

<p><input name="submit" type="submit" id="submit" tabindex="5" value="Отправить" title="Пожалуйста, проверьте комментарий перед отправкой">
<input type="hidden" name="comment_post_ID" value="26">
</p>
</div>
</form>




<div class="navigation group">
	<div class="alignleft"></div>
	<div class="alignright"></div>
</div>

</div> 

<!--menu-wrap-->
<div id="menu-wrap">
	<!--menu-->
	<div id="menu">
		<h3>Архивы</h3>		<ul>
			<li><a href="http://blog.epicsoft.ru/?m=201202" title="Февраль 2012">Февраль 2012</a></li>
	<li><a href="http://blog.epicsoft.ru/?m=201201" title="Январь 2012">Январь 2012</a></li>
		</ul>
<h3>Рубрики</h3>		<ul>
	<li class="cat-item cat-item-9"><a href="http://blog.epicsoft.ru/?cat=9" title="Просмотреть все записи в рубрике «C#»">C#</a>
</li>
	<li class="cat-item cat-item-5"><a href="http://blog.epicsoft.ru/?cat=5" title="Просмотреть все записи в рубрике «xNet»">xNet</a>
</li>
	<li class="cat-item cat-item-14"><a href="http://blog.epicsoft.ru/?cat=14" title="Просмотреть все записи в рубрике «Вконтакте»">Вконтакте</a>
</li>
	<li class="cat-item cat-item-16"><a href="http://blog.epicsoft.ru/?cat=16" title="Просмотреть все записи в рубрике «Программы»">Программы</a>
</li>
		</ul>
<h3>Ссылки</h3>
	<ul class="xoxo blogroll">
<li><a href="http://epicsoft.ru/" title="Главная страничка сайта" target="_blank">EpicSoft.ru</a></li>
<li><a href="http://epicsoft.ru/Blog/?feed=rss2" title="Подпишитесь на RSS-ленту этого сайта" target="_blank">RSS записей</a></li>
<li><a href="http://epicsoft.ru/Blog/?feed=comments-rss2" title="Последние комментарии ко всем записям в RSS" target="_blank">RSS комментариев</a></li>
<li><a href="http://epicsoft.ru/xNet" title="Библиотека классов для .NET Framework" target="_blank">xNet</a></li>

	</ul>

<h3>Метки</h3><div class="tagcloud"><a href="http://blog.epicsoft.ru/?tag=net" class="tag-link-4" title="6 записей" style="font-size: 22pt;">.NET</a>
<a href="http://blog.epicsoft.ru/?tag=c" class="tag-link-3" title="6 записей" style="font-size: 22pt;">C#</a>
<a href="http://blog.epicsoft.ru/?tag=http" class="tag-link-6" title="1 запись" style="font-size: 8pt;">HTTP</a>
<a href="http://blog.epicsoft.ru/?tag=vasan" class="tag-link-15" title="2 записи" style="font-size: 12.581818181818pt;">Vasan</a>
<a href="http://blog.epicsoft.ru/?tag=vkontakte-api" class="tag-link-13" title="2 записи" style="font-size: 12.581818181818pt;">Vkontakte api</a>
<a href="http://blog.epicsoft.ru/?tag=web" class="tag-link-7" title="1 запись" style="font-size: 8pt;">Web</a>
<a href="http://blog.epicsoft.ru/?tag=wpf" class="tag-link-17" title="1 запись" style="font-size: 8pt;">Wpf</a>
<a href="http://blog.epicsoft.ru/?tag=xnet" class="tag-link-5" title="5 записей" style="font-size: 20.218181818182pt;">xNet</a>
<a href="http://blog.epicsoft.ru/?tag=%d0%bc%d0%bd%d0%be%d0%b3%d0%be%d0%bf%d0%be%d1%82%d0%be%d1%87%d0%bd%d0%be%d1%81%d1%82%d1%8c" class="tag-link-10" title="1 запись" style="font-size: 8pt;">Многопоточность</a>
<a href="http://blog.epicsoft.ru/?tag=%d0%b2%d0%ba%d0%be%d0%bd%d1%82%d0%b0%d0%ba%d1%82%d0%b5-api" class="tag-link-12" title="2 записи" style="font-size: 12.581818181818pt;">Вконтакте API</a>
<a href="http://blog.epicsoft.ru/?tag=%d0%bd%d0%b0%d1%81%d1%82%d1%80%d0%be%d0%b9%d0%ba%d0%b8" class="tag-link-18" title="1 запись" style="font-size: 8pt;">Настройки</a>
<a href="http://blog.epicsoft.ru/?tag=%d0%bf%d0%b0%d1%80%d1%81%d0%b8%d0%bd%d0%b3" class="tag-link-11" title="1 запись" style="font-size: 8pt;">Парсинг</a>
<a href="http://blog.epicsoft.ru/?tag=%d1%81%d0%b5%d1%82%d1%8c" class="tag-link-8" title="1 запись" style="font-size: 8pt;">Сеть</a></div>
	</div>
	<!--/menu-->
</div>
<!--/menu-wrap-->

        <!--copyright-->
        <div id="copyright">
            <p id="text">
                Designed by X-rus, 2011-2012 © <a href="http://epicsoft.ru/">EpicSoft</a></p>
        </div>
        <!--/copyright-->

<!-- SyntaxHighlighter Stuff -->
<script type="text/javascript" src="./Работа с многопоточностью на xNet_files/shCore.js"></script>
	<script type="text/javascript" src="./Работа с многопоточностью на xNet_files/shBrushCSharp.js"></script>
	<!-- Reassign aliases -->
	<script type="text/javascript">
				SyntaxHighlighter.brushes.CSharp.aliases = ["c#", "c-sharp", "csharp"];
	</script>
<script type="text/javascript">
	SyntaxHighlighter.all();
</script>

    </div>
    <!--/main-->

</body></html>